/***
 *    - Feel free to do anything you want* with this code, consider it as PUBLIC DOMAIN -
 *               ... but be careful, this code is dark and full of terrors.
 *
 *                (*) NOT ALLOW TO USE THIS CODE FOR COMMERCIAL PURPOSES
 *
 *
 *
 *
 *              `:////-..`                                                                                                                `.-/oo:`
 *         .+yhmNNNNNNNNmh/.                                                                                                    -++ooyhhdmmmmmNNNd.
 *       /dNNddhydddNMNNNNNmo         ````````                                                                      `:ssoo/-  :hNNNmNNNNNNNNmddhoM.
 *     `yMmo::::::://smMMNNNNy`   .:ohmmmmmmmmyyyo+-`              ...`       ..///+++/..            .-/+++++-.    -dNmNNNNNy/hmNNMNmhssss+//:::yy`
 *     -Nd::::::::::::/ymMNNmmo `odNMMMNmNMMNNNNNNNmy.          `/hmmm+    ./odmmNNNNNNmmh/.     ./shddmNNNNNNmh/` :dmMNdooymmyhNMmo//:::::::::/N-
 *     oMo::::::+++/:::/omMNmdo+NNdys++///++sydmNMNNNms`     .:sdmMNMM+   /hmNMNNdddddNNNMNd-   /dddmMMMNmdddNNNNd/-hmMy/:::/NdmMdo/::::::///::/N
 *     sM-:::::+mNNm::::/sMNdy+Nd+/::::::::::://+odMMNNh    :hmNMmyoNM+  +mMNyo+////////+yNMm. :hdNMNhso///////+smNsomMy/::::NdMmo/:::/sssyoodhmo
 *     sM-::::+hNNhs::::/oMNh+hN:::::+osyo++::::::/sNMNm/  :NMmho/:/mM+ -mMmo:::::::::::::+mM+ ydMMh+::::::::::::+mMyyMm+:::hNmMd+::::oNh/`  `-o`
 *     sM-::::+dNNo:::::+hMNh/hm-::+hNMMMMNmds:::::/sMMm+  oMd//:::/mM+ sMNo::::::/+oo:::::yM+-dNMd/:::::/o+/::::/hMd:mMy::+MydMmo:::::/oyhhs+-`
 *     sM-::::+dNNNhs+ohmMNy/`oNo:/dMMMdyo++mmh+::::/dMm/  -NN+::::/mM+ yMm/::::/ymdNmo::::yM+:dMMo:::::smmm+::::+mMd sNN//ms`omMmo::::::://+sdds.
 *     sM-::::+dMdymmmNNNmhs+:/+hdysNMs/:::/mdmh:::::hMd:   /N+::::/mM+ oMm/::::/mmNd//:::/NN::dMd/::::-MMm/:::::sMm- `yMyhd`  -dNNy+/:::::::://ymo`
 *     sM-::::+dmmdmmmmmNNNNNNNd/-+ydM+::::/mmNs::::/mMy    /M+::::/mM+ `dMs:::::+hNNdyssdNNo :dMh/::::-MNNyo++sdNy-   .yNN:  ./yhmNNdyo/::::::::+Ns`
 *     sM-::::+dmMMdyhmmmNNNMNdh:   /N+::::/mdo::::/yMm.    /M+::::/mM+  -mNh/::::/+ymNMy+:.  :dMh/::::-Md+dmmmhy-      `..  +mNNmdmNNMNNdy+/:::::yN:
 *     sM-::::+dNNMm:///+osmMmh/    /N+::::///::::/hNNo     /M+::::/mM+  :mMNy:::::::/dMy     :dMh/::::-Mh `...             :mNNNNMmdyyyyNNmy+::::/M/
 *     sM-::::+dMddM:::::+yMNhh-    /N+:::::::::::/dMdh-    /M+::::/mM+ `yMms:::::::+sNm/     :dMh/::::-Mh                  +mNNMNy+//::/+mNNs+:::/M/
 *     sM/::::+dMddM:::::+hMmhh-    /N+::::://:::::sMNdo    /M+::::/mM+ -NNs::::::+dmmo.      :dMh/::::-Mh                  +dmMNs+::/sy/:hNNh+:::/M/
 *     -Nh::::/hMNNM:::::+hMmhh-    /N+::::/ym+::::oNMdh`   /M+::::/mM+ yMm/:::::/NN:`        :dMh/::::-Mh.:sys`            /hdMd+:::hNmd+MNms/:::hN:
 *      oN+::::+ymmy:::::+hMmhh-    /N+::::/mmN::::/hMNh/   /M+::::/mM+ sMm/:::::+Mm/`        :dMh/::::-MmyhdmNy.           `ydMd+:::smNNNNms/:::sNy
 *      `hmo/:::///::::::+hMmhs.    /N+::::/NmM+::::+MNds  `sM+::::/mM+ .mN+:::::/dMdy/       :dMh/::::-MNhhdNNMh`           -yMmo::::/syyo//:::oMm.
 *       `omdo/::::::::/+yNMdo`     /N+::::/NmNh::::/dMmh` +Mm/::::/mMo` +Nd::::::omMNdo.     /dMh/::::-MNdNNmsmM+            -dMd+:::::::::::+hNh-
 *         .smdy+////+sdNMmo-       yN+::::/NmNh:::::yMNh` oM/:::::/mMdo  hMs::::::+dMNNdo`   hdMh/::::-mdhho+:yMN:            -dNmy+///::/+shNmo`
 *           ./yhhhhhdmhy/`        `md:::::/dNMy+o+//oNN+  oM/:::::/mMmy  `hMo::::::/ymMMN+  :mmMh/::::://:::::/dMs             `+dMNddddhmNmy+.
 *               ``````            oNs:///ossmNmdhdddmNh`  +Nh-::::/dMMs   .yNh/::::::/yNMm. +dNMh/:::::::::::::sMN`              `:oshhhs+-.
 *                                .mdoyhdhdyyyso/``....`    md-:://omNm+     oNmo:::::::yMM/ .dMm/////////++++yyhNm`
 *                                `+ss+-``/++////-         -Nd-+hdmmy+.       :dMy/::::/mNo   smdhhhhhhhdddddhyy+/.
 *                                        `oys+:-.`        oMshNms-`           `yNNy/:omNo     `````.-/+osyso:/:
 *                                         :/oosoos+/-.````+NNh:.                -yNNhNm: ```.----/oyyysso++/::
 *                                        `+:/++++///ososssshho++++++/::::::::++++oydNms++ossyyyyssso+:-..++:/`
 *                                      `-/++-++:` `` ./++++ooossssyyyyyyyyyyyyyyyyyysso::::/+++:--.. `::++:/:
 *                                     ./++++-:/` /++: `/:``-++++--++-.-:////:--.-+++:` .:-- .++.`::``/+oso:++.
 *                                     .-:://.o+ -++++` -/- `/+++- -+/.  ::::::- `/+-  /++:` .+++++/ -oyyyy:-++:.
 *                                          `:yo`:yyys+ -++- -++++` /++- -++++++/+++:. `--///++++os: oyyyyys.```
 *                                          -yyy/ :syy- +yso .o+++- /++- -++++:/++++++/:-`  -sssyyy- yyyyyyy+`
 *                                         `+yyyys-`..`+ysyy .yyys- oyy` ::....syyys::syyys- +yyyyy- yyyyyys-
 *                                           `.:+yyyso..- -y- /sy: :yyy``yyyyyyyyyy+ `syyyy/`oyyyyy//yyys/-`
 *                                                -/oyyyyyyyy+.```/yys.` /ys+++:-oyy/`.---`:syyyyyys++-`
 *                                                   `..:oossyysoyyyyyoyo-..////+yyyyyooosyyyss+:.`
 *                                                           ``.-:/+oosyyyyyyyyyyyysooo+::-``
 *
 *
 *
 * Original game by Karoshi Corporation, released for MSX, CHECK OUT THIS! [http://karoshi.auic.es/]
 *
 * @CODE:                     =>  Mun                           | Twitter: @MoonWatcherMD     | Mail:                     |Notes: do you like puzzles? Try Poplis for Gamegear
 * @PROJECT:                  =>  #GrielsQuestMD
 * @START-DATE:               =>  20130509
 * @LAST-UPDATE:              =>  20170803
 * @LIB:                      =>  SGDK (v1.22a) by Stephane Dallongeville
 *
 *
 *
 * --------------------------------------------------------------------------------------------------------------------------------
 *  SPECIAL THANKS TO
 * --------------------------------------------------------------------------------------------------------------------------------
 *
 * @GRAPHICS                  => Dani Nevado                    | Twitter: @DanySnowyman      | Mail:                     |Notes:
 * @MUSIC                     => David Sánchez                  | Twitter: @DavidBonus        | Mail:                     |Notes:
 * @SFX                       => David Sánchez                  | Twitter: @DavidBonus        | Mail:                     |Notes:
 *
 * @ENGLISH-TRANSLATION       => Felipe Monge Corbalán          | Twitter: @vakapp            | Mail:                     |Notes:
 * @ITALIAN-TRANSLATION       => DaRkHoRaCe                     | Twitter: @oongamoonga       | Mail:                     |Notes:
 * @FRENCH-TRANSLATION        => KanedaFr                       | Twitter: @SpritesMind      ‏ | Mail:                     |Notes:
 * @CATALAN-TRANSLATION       => Jordi Montornés Solé           | Twitter: @jordimontornes   ‏ | Mail:                     |Notes:
 * @FINNISH-TRANSLATION       => Natsumi                        | Twitter:                    | Mail:                     |Notes:
 * @GALEGO-TRANSLATION        => Paspallas                      | Twitter: @PaspallasDev      | Mail:                     |Notes:
 * @BR-PORTUGUESE-TRANSLATION => Thiago F. Alves                | Twitter:                    | Mail:                     |Notes:
//         * @ESPERANTO-TRANSLATION     => teaduckie                      | Twitter:                    | Mail:                     |Notes:
//         * @INTERLINGUA-TRANSLATION   => teaduckie                      | Twitter:                    | Mail:                     |Notes:

 * @BETA-TESING               => Alfonso Martínez               | Twitter: @_SrPresley_       | Mail:                     |Notes:
 *
 * @SPECIAL-THANKS-TO         => Bruce Rodríguez                | Twitter: @emigrantebruce    | Mail:                     |Notes:
 * @SPECIAL-THANKS-TO         => Eduardo Robsy                  | Twitter: @EduRobsy    ‏      | Mail:                     |Notes:
 * @SPECIAL-THANKS-TO         => Jon Cortazar                   | Twitter: @Jon_Cortazar   ‏   | Mail:                     |Notes: #DietaTorreznos
 *
 * @ENGLISH-REVIEWER          => Clare Eddleston                | Twitter:                 ‏   | Mail:                     |Notes:
 * @ENGLISH-REVIEWER          => Xavier Bravo                   | Twitter:                 ‏   | Mail:                     |Notes:
 *
 *
 *
 * --------------------------------------------------------------------------------------------------------------------------------
 *  1985 ALTERNATIVO'S PHYSICAL RELEASE
 * --------------------------------------------------------------------------------------------------------------------------------
 *
 * @ILLUSTRATIONS             => Dani Nevado                    | Twitter: @DanySnowyman      | Mail:                     |Notes:
 * @COVER                     => Dani Nevado                    | Twitter: @DanySnowyman      | Mail:                     |Notes:
 * @INSTRUCTION-MANUAL        => Alfonso Martínez               | Twitter: @_SrPresley_       | Mail:                     |Notes:
 *
 *
 *
 * --------------------------------------------------------------------------------------------------------------------------------
 *  HOW TO COMPILE
 * --------------------------------------------------------------------------------------------------------------------------------
 *
 * Sega Genesis/Megadrive version of Griel's Quest for the Holy Porron was created using SGDK v1.22a and GenRes v1.1.
 *
 *  - Go gendev.spritesmind.net/page-genres.html
 *  - Download GenRes v1.1
 *  - Extract and replace all genres.* files in the zip into SGDK's bin directory
 *  - Compile #GrielsQuestMD
 *  - Ta-dah!
 *
 *
 *
 * --------------------------------------------------------------------------------------------------------------------------------
 *  KNOWN BUGS
 * --------------------------------------------------------------------------------------------------------------------------------
 *
 * -
 * -
 *
 *
 *
 * --------------------------------------------------------------------------------------------------------------------------------
 *  CHANGELOG
 * --------------------------------------------------------------------------------------------------------------------------------
 * 19-04-2017 » First release
 * 03-08-2017 » Works stunning on real hard
 * --------------------------------------------------------------------------------------------------------------------------------
 *
 */



#include "../inc/include.h"

void monos()
{
   JoyReader_update();

   if ( !joy1_pressed_btn )
   {
      return;
   }

   SYS_disableInts();
   VDP_loadTileSet ( ob_title_monos_mi.tileset, 16, 0 );
   VDP_setPalette ( PAL1, ob_title_monos_mi.palette->data );
   SYS_enableInts();

   u16 x = 0;
   u16 y = 0;

   while ( 1 )
   {
      SYS_disableInts();
      VDP_setMapEx ( PLAN_A, ob_title_monos_mi.map, TILE_ATTR_FULL(PAL1,0,0,0,16), 14, 10, x*13, y*6, 13, 6 );
      SYS_enableInts();

      ++x;

      if ( x == 10 )
      {
         x = 0;
         ++y;
      }

      if ( x == 6 && y == 6 )
      {
         x = 0;
         y = 0;
      }

      JoyReader_update();

      if ( joy1_pressed_btn )
      {
         break;
      }

      VDP_waitVSync();
   }

   displayOff( 30 );
}



void conio()
{
   VDP_drawText ( "============", 0, 0 );
   VDP_drawText ( "============", 0, 1 );
   VDP_drawText ( "============", 0, 2 );
   VDP_drawText ( "============", 0, 3 );
   VDP_drawText ( "============", 0, 4 );
   VDP_drawText ( "============", 0, 5 );

   inittextinfo();
   window(1,1,10,4);

   cputsxy(3,0,"AAAAA");
   delay(1000);
   clrscr();
   delay(1000);

   while(!kbhit())
   {
      cputsxy ( 0, 0, "holaaaaajldkj ");
      delay(1000);

//      putch('a'); delay(1000);
//      putch('e'); delay(1000);
//      putch('i'); delay(1000);
//      putch('o'); delay(1000);

      gotoxy(2,2);
      cputs("XXXXXXXXXXXXXXXXXXZ");
      delay(1000);

      clreol();
      delay(1000);

      clrscr();
      delay(1000);
   }
}





/*
 *
 * // FUNCIONA!!!!!!!
 *
 * execl is called by
 * execl(file, arg1, arg2, ..., (char *)(0));
 */
int execl(const char *file, const char *args, ...)
{
   #define  MAXARGS     31

   va_list ap;
   char *array[MAXARGS +1];
   int argno = 0;

   va_start(ap, args);
   while (args != 0 && argno < MAXARGS)
   {
      array[argno++] = (char*) args;
      args = va_arg(ap, const char *);
   }
   array[argno] = (char *) 0;
   va_end(ap);

   drawUInt ( argno, 0,0,4);
   waitMs(2000);

   return argno;
}





void object_viewer()
{
   s16 opcion = 12;

   vram_init ( 16 );
   vobject_init ( );


   while ( 1 )
   {
      JoyReader_update ( );

      if ( opcion == MAX_ANIMATIONS ) opcion = 0;
      if ( opcion == -1             ) opcion = MAX_ANIMATIONS - 1;

      SYS_disableInts();
      VDP_clearPlan ( PLAN_A, 1 );
      SYS_enableInts();

      VOBJECT *v = vobject_add ( opcion );
      vobject_reset ( opcion );
		animation_set_raw();
		animation_draw ( opcion, 10, 10, true, PLAN_A, 1, 0, 0, 0, 0 );
      VDP_setPalette ( animation_get ( opcion )->pal, animation_get ( opcion )->res->pal );

      drawUInt ( opcion, 2, 3, 3 );
      VDP_drawText ( v->object->name, 7, 3 );

      while ( 1 )
      {
         JoyReader_update();

         drawUInt( v->frame,5,5,2);
         VDP_drawText( "/", 8, 5);
         drawUInt( v->object->frames,10,5,2);

         if ( joy1_pressed_dir )
         {
            if ( joy1_pressed_right ) ++opcion;
            if ( joy1_pressed_left  ) --opcion;

            break;
         }

         vobject_update();
         vobject_upload ( );

         VDP_waitVSync();
      }

      vobject_reset(opcion);
      vobject_delete(opcion);

      VDP_waitVSync();
   }


}

void todas_las_pantallas ( )
{
   const u8 * pantallas[] =
   {
      "Sega",
      "Karoshi",
      "Titulo",
      "Opciones",
      "Intro",
      "Passwords",
      "Sound test",
      "Ending",
      "Game over",
      "Credits",
      "Puerta 1",
      "Puerta 2",
      "Puerta 3",
      "Final 1",
      "Final 2",
      "Final 3",
      "Mapa 1",
      "Mapa 2",
   };


   s16 opcion = 0;

   VDP_init();

   while ( 1 )
   {
      music_stop();

      JoyReader_update();



      VDP_drawText ( "Griel's Quest",  12,  1 );
      VDP_drawText ( "-------------",  12,  2 );
      VDP_drawText ( "  Level test ",  12,  5 );
      VDP_drawText ( "  2014-01-27 ",  12,  7 );
      VDP_drawText ( "<            >", 12, 12 );

      if ( opcion < 18 )
      {
         VDP_drawText ( pantallas[opcion], 14, 12 );
      }
      else
      {
         u8 str[4];
         uintToStr ( opcion - 18, str, 2 );
         VDP_drawText ( str, 21, 12 );
         VDP_drawText ( "Level:", 14, 12 );
      }





      if ( joy1_pressed_right ) ++opcion;
      if ( joy1_pressed_left  ) --opcion;

      if ( opcion >= 18 + 59 ) opcion = 18 + 59 - 1;
      if ( opcion <  0 ) opcion = 0;

      if (  joy1_pressed_abc )
      {
         //tool_reset ( );

         if ( opcion == 0 ) screen_sega   ( );
         if ( opcion == 1 ) screen_griels ( );
         if ( opcion == 2 ) screen_title  ( 0 );
         //if ( opcion == 3 ) screen_options ( );
         if ( opcion == 4 ) screen_intro ( 1 );
         if ( opcion == 5 ) pwd8_screen() ;
         if ( opcion == 6 ) screen_sound_test ( );
         //if ( opcion == 7 ) screen_ending ( );
         //if ( opcion == 8 ) screen_gameover ( );
         if ( opcion == 9 ) screen_staff();

         if ( opcion == 10) screen_puerta();
         if ( opcion == 11 )
         {
            gamestate.ambientes [ 0 ] = 0;
            gamestate.ambientes [ 1 ] = level_list [ 1 ] [ 0 ].cuantos;
            gamestate.ambientes [ 2 ] = 0;
            gamestate.ambientes [ 3 ] = level_list [ 3 ] [ 0 ].cuantos;
            screen_puerta();
         }

         if ( opcion == 12 )
         {
            gamestate.ambientes [ 0 ] = level_list [ 0 ] [ 0 ].cuantos;
            gamestate.ambientes [ 1 ] = level_list [ 1 ] [ 0 ].cuantos;
            gamestate.ambientes [ 2 ] = level_list [ 2 ] [ 0 ].cuantos;
            gamestate.ambientes [ 3 ] = level_list [ 3 ] [ 0 ].cuantos;
            screen_puerta();
         }

         if ( opcion == 13 )
         {
            gamestate.dificultad = 0;
            screen_final(0);
         }

         if ( opcion == 14 )
         {
            gamestate.dificultad = 1;
            screen_final(0);
         }

         if ( opcion == 15 )
         {
            gamestate.dificultad = 2;
            screen_final(0);
         }

         if ( opcion == 16 )
         {
            gamestate.visito_la_puerta = true;
            screen_mapa(TRUE);
         }

         if ( opcion == 17 )
         {
            gamestate.visito_la_puerta = false;
            screen_mapa(TRUE);
         }


         if ( opcion >= 18 ) game_play ( opcion - 10 );

//         tool_reset ( );
         VDP_init();
         VDP_setPlanSize ( 64, 32 );

//         joy_init ( );
//         joy_enable ( );
//         joy_set_handler ( JOY_HANDLER_COMMON );
      }
   }

}


u16 _check_password ( u8 password[], u16 *ptrLevel )
{
   u16 ret  = SCREEN_JUMP_TO_INTRO;
   u16 play = PSG_WRONG;


//    PENDIENTE DE REVISAR
//   LEVEL *levels = (LEVEL*) level ( );
//   u16 i;
//   for ( i = 1; i <= LEVEL_NB_LEVELS; i++ )
//   {
//      if ( my_strcmp ( password, levels[i].password ) )
//      {
//         *ptrLevel = i;
//         play = PSG_SELECT;
//         ret  = SCREEN_JUMP_TO_NEWGAME;
//      }
//   }

   if ( strcmp ( password, "SOUND"  ) == 0 )
   {
      play = PSG_START;
      ret = SCREEN_CHEAT_SOUND;
   }

   if ( strcmp ( password, "SONIC"  ) == 0 )
   {
      play = PSG_START;
      ret = SCREEN_CHEAT_SONIC;
   }

   if ( strcmp ( password, "KONAMI" ) == 0 )
   {
      play = PSG_START;
      ret = SCREEN_CHEAT_KONAMI;
   }

   if ( strcmp ( password, "STAFF"  ) == 0 )
   {
      play = PSG_START;
      ret = SCREEN_CHEAT_STAFF;
   }

   if ( strcmp ( password, "ENDING" ) == 0 )
   {
      play = PSG_START;
      ret = SCREEN_CHEAT_ENDING;
   }


   psglist_play ( play );

   return ret;
}







void jap()
{
   u8 i, ch;
   u8 str1[40] =  "鬆";
   u8 str2[40] =  "鬆大ｼｵ繧� ・�";
   u8 str3[40] =  "輔″蛻・￠";
   u8 str4[40] =  "蜍晏茜";
   u8 str5[40] =  "蠕礼せ";
   u8 str6[40] =  "繧ｳ繧､繝ｳ";

   i=0;
   ch = str1[i];
   while ( ch != '\0' )
   {
      drawUInt ( ch, 0, i, 3);
      ch = str1[i++];
   }
   drawUInt(i, 0, i, 2);

   i=0;
   ch = str2[i];
   while ( ch != '\0' )
   {
      drawUInt ( ch, 4, i, 3);
      ch = str2[i++];
   }
   drawUInt(i, 4, i, 2);

   i=0;
   ch = str3[i];
   while ( ch != '\0' )
   {
      drawUInt ( ch, 8, i, 3);
      ch = str3[i++];
   }
   drawUInt(i, 8, i, 2);

   i=0;
   ch = str4[i];
   while ( ch != '\0' )
   {
      drawUInt ( ch,12, i, 3);
      ch = str4[i++];
   }
   drawUInt(i,12, i, 2);

   i=0;
   ch = str5[i];
   while ( ch != '\0' )
   {
      drawUInt ( ch,16, i, 3);
      ch = str5[i++];
   }
   drawUInt(i,16, i, 2);

   i=0;
   ch = str6[i];
   while ( ch != '\0' )
   {
      drawUInt ( ch,20, i, 3);
      ch = str6[i++];
   }
   drawUInt(i,20, i, 2);


   while(1) ;
}


int main ( )
{
    //jap();
    dev_init ( 0 );

    JoyReader_init ( 1 );
    monos();

    //todas_las_pantallas ( );
    //object_viewer();
    //conio();


    gamestate.lenguaje = ENGLISH;


    SND_setForceDelayDMA_XGM ( true );

    VDP_setPlanSize ( 64, 32 );

    JOY_init ( );
    JOY_setSupport ( PORT_1, DEV ? JOY_SUPPORT_6BTN : JOY_SUPPORT_3BTN ); // JOY_SUPPORT_3BTN
    JOY_setSupport ( PORT_2, JOY_SUPPORT_OFF );

    JoyReader_init ( 1 );

    //vram_init ( TILE_USERINDEX );

    vint_init ( );
    //vint_setJoyReader ( true );

    SYS_setVIntCallback ( (_voidCallback*) vint_callback );
    font_init ( );

    gamestate_init ( ); // debe estar aqui y tras introducir un password correcto


    screen_disclaimer ( 1 );
    //screen_sega ( );
    screen_publisher ( );
    screen_oooklab ( );
    screen_languages();


//        screen_final(0);
//        screen_staff();
//        screen_oldintro();


    //http://www.dodgycoder.net/2012/02/coding-tricks-of-game-developers.html#
    __builtin_expect ( gamestate.current_ambiente, 0 );


    game_loop();

    return 0;
}
